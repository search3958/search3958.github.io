<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è¾²å ´çµŒå–¶ã‚²ãƒ¼ãƒ </title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            overflow: hidden;
            height: 100vh;
        }

        .screen {
            display: none;
            width: 100%;
            height: 100vh;
            position: relative;
        }

        .screen.active {
            display: block;
        }

        /* ãƒ˜ãƒƒãƒ€ãƒ¼ */
        .header {
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            color: white;
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
            position: relative;
            z-index: 100;
        }

        .stats {
            display: flex;
            gap: 20px;
            font-size: 18px;
        }

        .stat-item {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .nav-buttons {
            display: flex;
            gap: 10px;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: all 0.3s;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
        }

        .btn-primary {
            background: #4CAF50;
            color: white;
        }

        .btn-secondary {
            background: #2196F3;
            color: white;
        }

        .btn-warning {
            background: #FF9800;
            color: white;
        }

        .btn-small {
            padding: 5px 10px;
            font-size: 14px;
        }

        /* è¾²å ´ç”»é¢ */
        .farm-content {
            width: 100%;
            height: calc(100vh - 70px);
            position: relative;
            overflow: hidden;
        }

        .farm-viewport {
            width: 100%;
            height: 100%;
            position: relative;
            background: #8bc34a;
            overflow: hidden;
        }

        .farm-world {
            position: absolute;
            transition: transform 0.1s linear;
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(10, 60px);
            grid-template-rows: repeat(10, 60px);
            gap: 2px;
            padding: 20px;
        }

        .cell {
            width: 60px;
            height: 60px;
            background: #795548;
            border: 2px solid #5d4037;
            border-radius: 5px;
            position: relative;
            transition: all 0.2s;
        }

        .cell.seeded {
            background: #6d4c41;
        }

        .cell.growing {
            background: #7cb342;
        }

        .cell.ready {
            background: #ffd54f;
            animation: pulse 1s infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .plant {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 30px;
        }

        .tractor {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 50px;
            height: 50px;
            background: #f44336;
            border-radius: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            z-index: 50;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
            pointer-events: none;
        }

        /* å³ä¸Šã‚¤ãƒ³ãƒ™ãƒ³ãƒˆãƒª */
        .inventory-hud {
            position: fixed;
            top: 80px;
            right: 20px;
            display: flex;
            gap: 10px;
            align-items: center;
            z-index: 90;
        }

        .inventory-item-hud {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            padding: 15px 20px;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 18px;
            font-weight: bold;
        }

        /* å³ä¸‹æ°´ã‚¿ãƒ³ã‚¯ */
        .water-tank-hud {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            width: 250px;
            z-index: 90;
        }

        .water-tank-hud h3 {
            margin-bottom: 10px;
            color: #333;
            font-size: 18px;
        }

        .progress-bar {
            width: 100%;
            height: 20px;
            background: #e0e0e0;
            border-radius: 10px;
            overflow: hidden;
            margin-bottom: 10px;
        }

        .progress-fill {
            height: 100%;
            background: #2196F3;
            transition: width 0.3s;
        }

        /* ã‚·ãƒ§ãƒƒãƒ—ãƒ¢ãƒ¼ãƒ€ãƒ« */
        .shop-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 200;
            justify-content: center;
            align-items: center;
        }

        .shop-modal.active {
            display: flex;
        }

        .shop-content {
            background: white;
            padding: 30px;
            border-radius: 15px;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }

        .shop-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .shop-header h2 {
            color: #333;
        }

        .close-btn {
            background: #f44336;
            color: white;
            border: none;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 18px;
        }

        .shop-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            background: #f5f5f5;
            border-radius: 10px;
            margin-bottom: 15px;
        }

        .shop-item-info h4 {
            margin-bottom: 5px;
            color: #333;
        }

        .shop-item-info small {
            color: #666;
        }

        /* å¸‚å ´ç”»é¢ */
        .market-content {
            width: 100%;
            height: calc(100vh - 70px);
            position: relative;
        }

        .market-area {
            width: 100%;
            height: 100%;
            position: relative;
            background: #607d8b;
            overflow: hidden;
        }

        /* å³ä¸Šçµ±è¨ˆã¨ä¾¡æ ¼ */
        .market-info-hud {
            position: fixed;
            top: 80px;
            right: 20px;
            display: flex;
            flex-direction: column;
            gap: 10px;
            z-index: 90;
        }

        .info-panel {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            min-width: 200px;
        }

        .info-panel h3 {
            margin-bottom: 10px;
            color: #333;
            font-size: 16px;
        }

        .info-item {
            display: flex;
            justify-content: space-between;
            padding: 5px 0;
            font-size: 14px;
        }

        /* ä¸‹éƒ¨ãƒ™ãƒ«ãƒˆé…ç½® */
        .belt-controls {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            padding: 20px 30px;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            z-index: 90;
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .conveyor {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 80%;
            height: 100px;
            background: #455a64;
            border: 4px solid #263238;
            border-radius: 10px;
            overflow: hidden;
        }

        .conveyor-belt {
            width: 100%;
            height: 100%;
            background: repeating-linear-gradient(
                90deg,
                #546e7a,
                #546e7a 20px,
                #455a64 20px,
                #455a64 40px
            );
            animation: belt-move 2s linear infinite;
        }

        @keyframes belt-move {
            0% { background-position: 0 0; }
            100% { background-position: 40px 0; }
        }

        .harvest-item {
            position: absolute;
            width: 40px;
            height: 40px;
            font-size: 30px;
            animation: move-on-belt 5s linear;
        }

        @keyframes move-on-belt {
            0% { left: 0; }
            100% { left: 100%; }
        }

        .parking-lot {
            position: absolute;
            bottom: 50px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 20px;
        }

        .parking-spot {
            width: 100px;
            height: 150px;
            background: #90a4ae;
            border: 3px dashed #fff;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 40px;
            position: relative;
        }

        .truck {
            animation: truck-arrive 2s ease-in-out;
        }

        @keyframes truck-arrive {
            0% { transform: translateY(-200px); opacity: 0; }
            100% { transform: translateY(0); opacity: 1; }
        }

        .coin-popup {
            position: absolute;
            top: -30px;
            color: #ffd700;
            font-weight: bold;
            font-size: 20px;
            animation: float-up 1s ease-out forwards;
        }

        @keyframes float-up {
            0% { transform: translateY(0); opacity: 1; }
            100% { transform: translateY(-50px); opacity: 0; }
        }

        .achievement {
            position: fixed;
            top: 100px;
            right: 20px;
            background: #4CAF50;
            color: white;
            padding: 15px 20px;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
            animation: slide-in 0.5s ease-out;
            z-index: 1000;
        }

        @keyframes slide-in {
            from { transform: translateX(400px); }
            to { transform: translateX(0); }
        }

        .weather {
            position: fixed;
            top: 80px;
            left: 20px;
            font-size: 40px;
            animation: weather-float 3s ease-in-out infinite;
            z-index: 90;
        }

        @keyframes weather-float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
    </style>
</head>
<body>
    <!-- è¾²å ´ç”»é¢ -->
    <div class="screen active" id="farmScreen">
        <div class="header">
            <div class="stats">
                <div class="stat-item">ğŸª™ <span id="coins">100</span></div>
                <div class="stat-item">ğŸ“Š Lv.<span id="level">1</span></div>
            </div>
            <div class="nav-buttons">
                <button class="btn btn-secondary" onclick="switchScreen('market')">ğŸª å¸‚å ´ã¸</button>
            </div>
        </div>

        <div class="farm-content">
            <div class="farm-viewport">
                <div class="weather" id="weather">â˜€ï¸</div>
                <div class="farm-world" id="farmWorld">
                    <div class="grid" id="farmGrid"></div>
                </div>
                <div class="tractor">ğŸšœ</div>
            </div>

            <!-- å³ä¸Šã‚¤ãƒ³ãƒ™ãƒ³ãƒˆãƒª -->
            <div class="inventory-hud">
                <div class="inventory-item-hud">
                    <span>ğŸŒ¾</span>
                    <span id="seedCount">10</span>
                </div>
                <div class="inventory-item-hud">
                    <span>ğŸŒ½</span>
                    <span id="harvestCount">0</span>
                </div>
                <button class="btn btn-primary btn-small" onclick="openShop()">ğŸª ã‚·ãƒ§ãƒƒãƒ—</button>
            </div>

            <!-- å³ä¸‹æ°´ã‚¿ãƒ³ã‚¯ -->
            <div class="water-tank-hud">
                <h3>ğŸ’§ æ°´ã‚¿ãƒ³ã‚¯</h3>
                <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                    <span id="waterText">100/100</span>
                    <span><span id="waterPercent">100</span>%</span>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" id="waterBar" style="width: 100%"></div>
                </div>
                <button class="btn btn-primary" style="width: 100%;" onclick="refillWater()">è£œå…… (ğŸ’°10)</button>
            </div>
        </div>
    </div>

    <!-- å¸‚å ´ç”»é¢ -->
    <div class="screen" id="marketScreen">
        <div class="header">
            <div class="stats">
                <div class="stat-item">ğŸª™ <span id="coinsMarket">100</span></div>
                <div class="stat-item">ğŸšš é§è»Šå ´: <span id="parkingCount">2</span></div>
            </div>
            <div class="nav-buttons">
                <button class="btn btn-secondary" onclick="switchScreen('farm')">ğŸŒ¾ è¾²å ´ã¸</button>
            </div>
        </div>
        <div class="market-content">
            <div class="market-area">
                <div class="conveyor">
                    <div class="conveyor-belt" id="conveyorBelt"></div>
                </div>
                <div class="parking-lot" id="parkingLot"></div>
                <div style="position: absolute; top: 50px; left: 50%; transform: translateX(-50%); text-align: center; color: white;">
                    <h2>ğŸšš è‡ªå‹•å‡ºè·ã‚·ã‚¹ãƒ†ãƒ </h2>
                    <p>åç©«ç‰©ã‚’ãƒ™ãƒ«ãƒˆã‚³ãƒ³ãƒ™ã‚¢ã«é…ç½®ã™ã‚‹ã¨ã€ãƒˆãƒ©ãƒƒã‚¯ãŒè‡ªå‹•ã§é›†è·ã—ã¾ã™</p>
                </div>
            </div>

            <!-- å³ä¸Šçµ±è¨ˆã¨ä¾¡æ ¼ -->
            <div class="market-info-hud">
                <div class="info-panel">
                    <h3>ğŸ’° ä¾¡æ ¼è¡¨</h3>
                    <div class="info-item">
                        <span>ğŸŒ½ åç©«ç‰©</span>
                        <span>15ã‚³ã‚¤ãƒ³</span>
                    </div>
                </div>
                <div class="info-panel">
                    <h3>ğŸ“Š çµ±è¨ˆ</h3>
                    <div class="info-item">
                        <span>ç·å£²ä¸Š</span>
                        <span id="totalSales">0</span>
                    </div>
                    <div class="info-item">
                        <span>å‡ºè·æ•°</span>
                        <span id="totalShipped">0</span>
                    </div>
                </div>
                <button class="btn btn-primary" style="width: 100%;" onclick="openShop()">ğŸª ã‚·ãƒ§ãƒƒãƒ—</button>
            </div>

            <!-- ä¸‹éƒ¨ãƒ™ãƒ«ãƒˆé…ç½® -->
            <div class="belt-controls">
                <div style="display: flex; align-items: center; gap: 10px;">
                    <span style="font-size: 24px;">ğŸŒ½</span>
                    <span style="font-weight: bold; font-size: 18px;"><span id="harvestCountMarket">0</span> å€‹</span>
                </div>
                <button class="btn btn-primary" onclick="placeOnBelt()">ãƒ™ãƒ«ãƒˆã«é…ç½®</button>
            </div>
        </div>
    </div>

    <!-- ã‚·ãƒ§ãƒƒãƒ—ãƒ¢ãƒ¼ãƒ€ãƒ« -->
    <div class="shop-modal" id="shopModal">
        <div class="shop-content">
            <div class="shop-header">
                <h2>ğŸª ã‚·ãƒ§ãƒƒãƒ—</h2>
                <button class="close-btn" onclick="closeShop()">Ã—</button>
            </div>
            
            <h3 style="margin-bottom: 15px; color: #666;">è³¼å…¥</h3>
            <div class="shop-item">
                <div class="shop-item-info">
                    <h4>ğŸŒ¾ ã‚¿ãƒ x10</h4>
                    <small>ä½œç‰©ã‚’è‚²ã¦ã‚‹ãŸã‚ã®ã‚¿ãƒ</small>
                </div>
                <div>
                    <div style="margin-bottom: 5px; font-weight: bold;">ğŸ’° 20</div>
                    <button class="btn btn-primary btn-small" onclick="buySeeds()">è³¼å…¥</button>
                </div>
            </div>

            <h3 style="margin: 25px 0 15px; color: #666;">ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰</h3>
            <div class="shop-item">
                <div class="shop-item-info">
                    <h4>âš¡ æ©Ÿæ¢°é€Ÿåº¦UP</h4>
                    <small>ãƒˆãƒ©ã‚¯ã‚¿ãƒ¼ã®ç§»å‹•é€Ÿåº¦ãŒä¸Šæ˜‡</small>
                </div>
                <div>
                    <div style="margin-bottom: 5px; font-weight: bold;">ğŸ’° <span id="speedUpgradeCost">50</span></div>
                    <button class="btn btn-warning btn-small" onclick="upgradeSpeed()">UP</button>
                </div>
            </div>

            <div class="shop-item">
                <div class="shop-item-info">
                    <h4>ğŸ’§ ã‚¿ãƒ³ã‚¯å®¹é‡UP</h4>
                    <small>æ°´ã‚¿ãƒ³ã‚¯ã®æœ€å¤§å®¹é‡ãŒå¢—åŠ </small>
                </div>
                <div>
                    <div style="margin-bottom: 5px; font-weight: bold;">ğŸ’° <span id="tankUpgradeCost">100</span></div>
                    <button class="btn btn-warning btn-small" onclick="upgradeTank()">UP</button>
                </div>
            </div>

            <div class="shop-item">
                <div class="shop-item-info">
                    <h4>ğŸšš é§è»Šå ´+1</h4>
                    <small>åŒæ™‚å‡ºè·ã§ãã‚‹ãƒˆãƒ©ãƒƒã‚¯ãŒå¢—åŠ </small>
                </div>
                <div>
                    <div style="margin-bottom: 5px; font-weight: bold;">ğŸ’° <span id="parkingCost">200</span></div>
                    <button class="btn btn-warning btn-small" onclick="upgradeParking()">è³¼å…¥</button>
                </div>
            </div>

            <div style="margin-top: 20px; padding: 15px; background: #e3f2fd; border-radius: 10px;">
                <div style="font-size: 14px; color: #666;">
                    <strong>æ“ä½œæ–¹æ³•:</strong><br>
                    â†‘â†“â†â†’ ã¾ãŸã¯ WASD ã§ç§»å‹•<br>
                    ã‚¿ãƒã®ä¸Šã‚’é€šã‚‹ã¨ç¨®ã¾ã<br>
                    è‚²ã£ãŸä½œç‰©ã®ä¸Šã‚’é€šã‚‹ã¨åç©«
                </div>
            </div>
        </div>
    </div>

    <script>
        // ã‚²ãƒ¼ãƒ çŠ¶æ…‹
        const game = {
            coins: 100,
            water: 100,
            maxWater: 100,
            seeds: 10,
            harvest: 0,
            level: 1,
            exp: 0,
            tractorSpeed: 5,
            parkingSpots: 2,
            totalSales: 0,
            totalShipped: 0,
            speedUpgradeLevel: 0,
            tankUpgradeLevel: 0,
            parkingUpgradeLevel: 0
        };

        // ãƒˆãƒ©ã‚¯ã‚¿ãƒ¼ä½ç½®ï¼ˆãƒ¯ãƒ¼ãƒ«ãƒ‰åº§æ¨™ï¼‰
        const tractor = {
            x: 350,
            y: 350
        };

        // ã‚«ãƒ¡ãƒ©ã‚ªãƒ•ã‚»ãƒƒãƒˆ
        const camera = {
            x: 0,
            y: 0
        };

        // ã‚­ãƒ¼å…¥åŠ›
        const keys = {};
        document.addEventListener('keydown', e => keys[e.key.toLowerCase()] = true);
        document.addEventListener('keyup', e => keys[e.key.toLowerCase()] = false);

        // è¾²å ´ã‚°ãƒªãƒƒãƒ‰åˆæœŸåŒ–
        const gridSize = 10;
        const cells = [];
        const farmGrid = document.getElementById('farmGrid');

        for (let y = 0; y < gridSize; y++) {
            cells[y] = [];
            for (let x = 0; x < gridSize; x++) {
                const cell = document.createElement('div');
                cell.className = 'cell';
                cell.dataset.x = x;
                cell.dataset.y = y;
                farmGrid.appendChild(cell);
                cells[y][x] = {
                    element: cell,
                    state: 'empty',
                    growthTime: 0,
                    maxGrowth: 10
                };
            }
        }

        // ãƒˆãƒ©ã‚¯ã‚¿ãƒ¼ç§»å‹•ã¨ã‚«ãƒ¡ãƒ©è¿½å¾“
        function updateTractor() {
            const speed = game.tractorSpeed;
            
            if (keys['arrowup'] || keys['w']) tractor.y -= speed;
            if (keys['arrowdown'] || keys['s']) tractor.y += speed;
            if (keys['arrowleft'] || keys['a']) tractor.x -= speed;
            if (keys['arrowright'] || keys['d']) tractor.x += speed;

            // å¢ƒç•Œãƒã‚§ãƒƒã‚¯ï¼ˆã‚°ãƒªãƒƒãƒ‰ã®ç¯„å›²å†…ï¼‰
            const minX = 20;
            const maxX = 20 + (gridSize * 62) - 50;
            const minY = 20;
            const maxY = 20 + (gridSize * 62) - 50;
            
            tractor.x = Math.max(minX, Math.min(tractor.x, maxX));
            tractor.y = Math.max(minY, Math.min(tractor.y, maxY));

            // ã‚«ãƒ¡ãƒ©æ›´æ–°ï¼ˆãƒˆãƒ©ã‚¯ã‚¿ãƒ¼ã‚’ä¸­å¿ƒã«ï¼‰
            const viewportWidth = window.innerWidth;
            const viewportHeight = window.innerHeight - 70;
            
            camera.x = tractor.x - viewportWidth / 2;
            camera.y = tractor.y - viewportHeight / 2;

            // ãƒ¯ãƒ¼ãƒ«ãƒ‰ã‚’ç§»å‹•
            const farmWorld = document.getElementById('farmWorld');
            farmWorld.style.transform = `translate(${-camera.x}px, ${-camera.y}px)`;

            // ã‚°ãƒªãƒƒãƒ‰ä½ç½®è¨ˆç®—
            const gridX = Math.floor((tractor.x - 20) / 62);
            const gridY = Math.floor((tractor.y - 20) / 62);

            // ã‚»ãƒ«ã¨ã®ç›¸äº’ä½œç”¨
            if (gridX >= 0 && gridX < gridSize && gridY >= 0 && gridY < gridSize) {
                const cell = cells[gridY][gridX];
                
                if (cell.state === 'empty' && game.seeds > 0) {
                    cell.state = 'seeded';
                    cell.element.className = 'cell seeded';
                    cell.element.innerHTML = '<div class="plant">ğŸŒ±</div>';
                    game.seeds--;
                    updateUI();
                    playSound('plant');
                } else if (cell.state === 'ready') {
                    cell.state = 'empty';
                    cell.element.className = 'cell';
                    cell.element.innerHTML = '';
                    cell.growthTime = 0;
                    game.harvest++;
                    addExp(10);
                    updateUI();
                    playSound('harvest');
                }
            }
        }

        // ä½œç‰©æˆé•·ã‚·ã‚¹ãƒ†ãƒ 
        function growCrops() {
            if (game.water <= 0) return;

            cells.forEach(row => {
                row.forEach(cell => {
                    if (cell.state === 'seeded' || cell.state === 'growing') {
                        cell.growthTime++;
                        
                        if (cell.growthTime >= cell.maxGrowth) {
                            cell.state = 'ready';
                            cell.element.className = 'cell ready';
                            cell.element.innerHTML = '<div class="plant">ğŸŒ½</div>';
                        } else if (cell.growthTime > cell.maxGrowth / 2) {
                            cell.state = 'growing';
                            cell.element.className = 'cell growing';
                            cell.element.innerHTML = '<div class="plant">ğŸŒ¿</div>';
                        }
                    }
                });
            });

            game.water = Math.max(0, game.water - 0.1);
            updateUI();
        }

        // æ°´è£œå……
        function refillWater() {
            if (game.coins >= 10) {
                game.coins -= 10;
                game.water = game.maxWater;
                updateUI();
                playSound('water');
            } else {
                alert('ã‚³ã‚¤ãƒ³ãŒè¶³ã‚Šã¾ã›ã‚“ï¼');
            }
        }

        // ã‚¿ãƒè³¼å…¥
        function buySeeds() {
            if (game.coins >= 20) {
                game.coins -= 20;
                game.seeds += 10;
                updateUI();
                playSound('buy');
            } else {
                alert('ã‚³ã‚¤ãƒ³ãŒè¶³ã‚Šã¾ã›ã‚“ï¼');
            }
        }

        // ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰
        function upgradeSpeed() {
            const cost = 50 + game.speedUpgradeLevel * 50;
            if (game.coins >= cost) {
                game.coins -= cost;
                game.tractorSpeed += 1;
                game.speedUpgradeLevel++;
                updateUI();
                playSound('upgrade');
                showAchievement('âš¡ é€Ÿåº¦ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰å®Œäº†ï¼');
            } else {
                alert('ã‚³ã‚¤ãƒ³ãŒè¶³ã‚Šã¾ã›ã‚“ï¼');
            }
        }

        function upgradeTank() {
            const cost = 100 + game.tankUpgradeLevel * 100;
            if (game.coins >= cost) {
                game.coins -= cost;
                game.maxWater += 50;
                game.water = game.maxWater;
                game.tankUpgradeLevel++;
                updateUI();
                playSound('upgrade');
                showAchievement('ğŸ’§ ã‚¿ãƒ³ã‚¯å®¹é‡ã‚¢ãƒƒãƒ—ï¼');
            } else {
                alert('ã‚³ã‚¤ãƒ³ãŒè¶³ã‚Šã¾ã›ã‚“ï¼');
            }
        }

        function upgradeParking() {
            const cost = 200 + game.parkingUpgradeLevel * 200;
            if (game.coins >= cost) {
                game.coins -= cost;
                game.parkingSpots++;
                game.parkingUpgradeLevel++;
                initParkingLot();
                updateUI();
                playSound('upgrade');
                showAchievement('ğŸšš é§è»Šå ´æ‹¡å¼µå®Œäº†ï¼');
            } else {
                alert('ã‚³ã‚¤ãƒ³ãŒè¶³ã‚Šã¾ã›ã‚“ï¼');
            }
        }

        // UIæ›´æ–°
        function updateUI() {
            document.getElementById('coins').textContent = game.coins;
            document.getElementById('coinsMarket').textContent = game.coins;
            const waterPercent = (game.water / game.maxWater) * 100;
            document.getElementById('waterText').textContent = Math.floor(game.water) + '/' + game.maxWater;
            document.getElementById('waterPercent').textContent = Math.floor(waterPercent);
            document.getElementById('waterBar').style.width = waterPercent + '%';
            document.getElementById('level').textContent = game.level;
            document.getElementById('seedCount').textContent = game.seeds;
            document.getElementById('harvestCount').textContent = game.harvest;
            document.getElementById('harvestCountMarket').
            document.getElementById('harvestCountMarket').textContent = game.harvest;
            document.getElementById('parkingCount').textContent = game.parkingSpots;
            document.getElementById('totalSales').textContent = game.totalSales;
            document.getElementById('totalShipped').textContent = game.totalShipped;
            
            document.getElementById('speedUpgradeCost').textContent = 50 + game.speedUpgradeLevel * 50;
            document.getElementById('tankUpgradeCost').textContent = 100 + game.tankUpgradeLevel * 100;
            document.getElementById('parkingCost').textContent = 200 + game.parkingUpgradeLevel * 200;
        }

        // çµŒé¨“å€¤ã¨ãƒ¬ãƒ™ãƒ«
        function addExp(amount) {
            game.exp += amount;
            const expNeeded = game.level * 100;
            if (game.exp >= expNeeded) {
                game.level++;
                game.exp = 0;
                showAchievement('ğŸ‰ ãƒ¬ãƒ™ãƒ«ã‚¢ãƒƒãƒ—ï¼ Lv.' + game.level);
                game.coins += 50;
            }
        }

        // ã‚·ãƒ§ãƒƒãƒ—é–‹é–‰
        function openShop() {
            document.getElementById('shopModal').classList.add('active');
        }

        function closeShop() {
            document.getElementById('shopModal').classList.remove('active');
        }

        // ç”»é¢åˆ‡ã‚Šæ›¿ãˆ
        function switchScreen(screen) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            if (screen === 'farm') {
                document.getElementById('farmScreen').classList.add('active');
            } else {
                document.getElementById('marketScreen').classList.add('active');
            }
        }

        // ãƒ™ãƒ«ãƒˆã‚³ãƒ³ãƒ™ã‚¢
        function placeOnBelt() {
            if (game.harvest <= 0) {
                alert('å‡ºè·ã™ã‚‹åç©«ç‰©ãŒã‚ã‚Šã¾ã›ã‚“ï¼');
                return;
            }

            const belt = document.getElementById('conveyorBelt');
            const item = document.createElement('div');
            item.className = 'harvest-item';
            item.textContent = 'ğŸŒ½';
            item.style.top = '30px';
            belt.appendChild(item);
            
            game.harvest--;
            updateUI();
            playSound('belt');

            setTimeout(() => {
                item.remove();
                processSale();
            }, 5000);
        }

        // å£²å´å‡¦ç†
        function processSale() {
            const spots = document.querySelectorAll('.parking-spot');
            let placed = false;

            for (let spot of spots) {
                if (!spot.classList.contains('occupied')) {
                    spot.classList.add('occupied');
                    spot.innerHTML = '<div class="truck">ğŸšš</div>';
                    
                    setTimeout(() => {
                        const coins = 15;
                        game.coins += coins;
                        game.totalSales += coins;
                        game.totalShipped++;
                        
                        const popup = document.createElement('div');
                        popup.className = 'coin-popup';
                        popup.textContent = '+' + coins + 'ğŸª™';
                        spot.appendChild(popup);
                        
                        setTimeout(() => popup.remove(), 1000);
                        
                        updateUI();
                        playSound('sell');
                        
                        setTimeout(() => {
                            spot.classList.remove('occupied');
                            spot.innerHTML = '';
                        }, 2000);
                    }, 1000);
                    
                    placed = true;
                    break;
                }
            }

            if (!placed) {
                alert('é§è»Šå ´ãŒæº€è»Šã§ã™ï¼é§è»Šå ´ã‚’ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ã—ã¦ãã ã•ã„ã€‚');
            }
        }

        // é§è»Šå ´åˆæœŸåŒ–
        function initParkingLot() {
            const parkingLot = document.getElementById('parkingLot');
            parkingLot.innerHTML = '';
            
            for (let i = 0; i < game.parkingSpots; i++) {
                const spot = document.createElement('div');
                spot.className = 'parking-spot';
                parkingLot.appendChild(spot);
            }
        }

        // å®Ÿç¸¾è¡¨ç¤º
        function showAchievement(text) {
            const achievement = document.createElement('div');
            achievement.className = 'achievement';
            achievement.textContent = text;
            document.body.appendChild(achievement);
            
            setTimeout(() => achievement.remove(), 3000);
        }

        // ã‚µã‚¦ãƒ³ãƒ‰ã‚¨ãƒ•ã‚§ã‚¯ãƒˆ
        function playSound(type) {
            console.log('ğŸ”Š Sound:', type);
        }

        // å¤©å€™ã‚·ã‚¹ãƒ†ãƒ 
        function updateWeather() {
            const weathers = ['â˜€ï¸', 'â›…', 'â˜ï¸', 'ğŸŒ§ï¸'];
            const weather = weathers[Math.floor(Math.random() * weathers.length)];
            document.getElementById('weather').textContent = weather;
            
            if (weather === 'ğŸŒ§ï¸') {
                game.water = Math.min(game.maxWater, game.water + 10);
            }
        }

        // ã‚²ãƒ¼ãƒ ãƒ«ãƒ¼ãƒ—
        let lastTime = 0;
        function gameLoop(timestamp) {
            const deltaTime = timestamp - lastTime;
            
            if (deltaTime > 16) {
                updateTractor();
                lastTime = timestamp;
            }
            
            requestAnimationFrame(gameLoop);
        }

        // å®šæœŸå‡¦ç†
        setInterval(growCrops, 1000);
        setInterval(updateWeather, 30000);

        // åˆæœŸåŒ–
        initParkingLot();
        updateUI();
        gameLoop(0);
    </script>
</body>
</html>