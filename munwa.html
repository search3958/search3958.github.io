
<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>문화텏트</title>
  <link href="https://fonts.googleapis.com/css2?family=M+PLUS+1p:wght@400;700&display=swap" rel="stylesheet">
  <style>
    :root{--preview-h:20vh; font-family:"M PLUS 1p", system-ui,-apple-system,"Segoe UI",Roboto,'Yu Gothic',"Hiragino Kaku Gothic ProN",Meiryo,Arial}
    html,body{height:100%;margin:0;background:#060609;color:#fff;overflow:hidden}
    .screen{display:flex;flex-direction:column;width:100%;height:100vh;align-items:center;justify-content:flex-start;overflow:hidden}
    .page-current,.page-next{box-sizing:border-box;border-radius:10px;overflow:hidden;width:96%;max-width:1400px;}
    .page-current{padding:4px;display:flex;flex-direction:column;gap:6px;flex-grow:1;height:calc(100% - var(--preview-h));}
    .page-next{height:var(--preview-h);margin-bottom:4px;padding:4px;display:flex;align-items:center;justify-content:center;background:#111827;}
    .block{border-radius:6px;padding:6px;overflow:hidden}
    .block .text{width:100%;text-align:center;white-space:pre-wrap;font-weight:400;line-height:1.3}
    .blk-Orange{background:#5c2a00;color:#ffcc80;font-size:clamp(20px,4vw,36px)}
    .blk-Green{background:#0f3d1a;color:#a8f0c2;font-size:clamp(20px,4vw,36px)}
    .blk-Pink{background:#4d0d2a;color:#ffb7dc;font-size:clamp(20px,4vw,36px)}
    .blk-Text{background:#111827;color:#eaf6ff;display:flex;align-items:center;justify-content:center;font-size:clamp(28px,6vw,64px);flex-grow:1;}
    .blk-Text .text{flex-grow:1; display:flex; align-items:center; justify-content:center; height:100%;}
    .page-next .text{font-size:clamp(16px,3vw,24px)}
    .controls{position:fixed;right:12px;bottom:12px;display:flex;gap:8px;z-index:99}
    .btn{background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);color:#fff;padding:32px;border-radius:16px;cursor:pointer;font-weight:700}
    .meta{position:fixed;left:12px;bottom:12px;font-size:12px;opacity:.6;z-index:98}
  </style>
</head>
<body>

<div class="screen">
  <div id="pageCurrent" class="page-current" data-key></div>
  <div id="pageNext" class="page-next" aria-hidden="true"></div>
</div>

<div class="controls">
  <button id="backBtn" class="btn">◀︎ Back</button>
  <button id="nextBtn" class="btn">Next ▶︎</button>
</div>
<div class="meta">
  同期間隔: <span id="intervalMs">100</span>ms
  <!-- ページジャンプ機能追加 -->
  <span style="margin-left:16px;">
    ページ: <input id="pageJumpInput" type="number" min="1" style="width:48px;">
    <button id="pageJumpBtn" class="btn" style="padding:2px 8px;font-size:12px;">移動</button>
  </span>
</div>

<script id="pages-data" type="application/json">
  

[{"Orange":"駅","Green":"","Pink":"","Text":"Scene 1:プロローグと集結【3分】:"},{"Orange":"","Green":"","Pink":"","Text":"スカウトマン:もし、人生を変えるチャンスがあるとしたら...やってみたいと思いませんか？"},{"Orange":"","Green":"","Pink":"","Text":"ギフン:...借金まみれの俺に、都合のいい話があるわけ....!"},{"Orange":"","Green":"","Pink":"","Text":"スカウトマン:私とゲームをしませんか？"},{"Orange":"","Green":"","Pink":"","Text":"スカウトマン:簡単なゲームです。勝てばお金が手に入る。ルールはただ一つ。
私のメンコをヒックリ返せれば勝ちです。"},{"Orange":"","Green":"","Pink":"","Text":":(メンコを床に置く。)"},{"Orange":"","Green":"","Pink":"叩きつけてもひっくり返らない。","Text":"ギフン:子供の遊びかよ。"},{"Orange":"","Green":"","Pink":"ギフンの頬を軽くしばくシグ座。","Text":"スカウトマン:負けたら...代わりに体で払って持たいますよ。"},{"Orange":"","Green":"","Pink":"","Text":"ギフン:ふざけんな！"},{"Orange":"","Green":"","Pink":"","Text":":(これらを何度も繰り返して。ついにギフンが勝つ)"},{"Orange":"","Green":"","Pink":"","Text":"ギフン:やった！ひっくり返したぞ！"},{"Orange":"video start","Green":"","Pink":"名刺を渡す","Text":"スカウトマン:あなたには、資格があります。"},{"Orange":"Change Screen [開始]","Green":"All Lights OFF","Pink":"","Text":"OBS:"},{"Orange":" ","Green":"All Lights ON","Pink":"","Text":"ピンクマン:起きろ。ゲームの始まりだ。"},{"Orange":"Screen OFF","Green":"","Pink":"","Text":"フロントマン（登場）:皆さん。ようこそ。これより、公平な競争を行います。
賞金は、456億ウォン。脱落者は即時失格。つまり、『死』です。"},{"Orange":"","Green":"All Lights OFF","Pink":"（セリフは特にないが裏でガヤガヤする）","Text":"ギフン:嘘だろ？"},{"Orange":"","Green":"","Pink":"","Text":"Scene 2: Game 1 だるまさんがころんだ【3分】:"},{"Orange":"Change Screen [だるまさんがころんだ]","Green":"","Pink":"","Text":"キャラクター:セリフ"},{"Orange":"","Green":"All Lights ON","Pink":"","Text":"フロントマン:最初のゲームは――『だるまさんがころんだ』です。制限時間内にゴールへ到達してください。動いたものは即脱落となります。"},{"Orange":"","Green":"","Pink":"","Text":"（人形役）:だ〜る〜ま〜さ〜ん〜が〜…こ〜ろ〜ん〜だ！"},{"Orange":"","Green":"","Pink":"","Text":"モブ1:うわぁぁっ！"},{"Orange":"","Green":"","Pink":"","Text":"ギフン:ひっ……！動くな！"},{"Orange":"","Green":"","Pink":"","Text":"ドクス:ちっ……お遊びのつもりがマジじゃねえかよ！ ……俺は絶対に生き残ってやる！"},{"Orange":"","Green":"","Pink":"","Text":"（人形役）:だ〜る〜ま〜さ〜ん〜が〜…こ〜ろ〜ん〜だ！"},{"Orange":"","Green":"","Pink":"","Text":"モブ2:や、やめ――！"},{"Orange":"","Green":"","Pink":"","Text":"ジヨン:……セビョク！手を！"},{"Orange":"","Green":"","Pink":"","Text":"セビョク:っ……ありがとう。"},{"Orange":"","Green":"","Pink":"","Text":"（人形役）:だ〜る〜ま〜さ〜ん〜が〜…こ〜ろ〜ん〜だ！"},{"Orange":"","Green":"","Pink":"","Text":"ギフン:走れっ！ゴールまであと少しだ！"},{"Orange":"","Green":"","Pink":"","Text":"（数名のプレイヤー）:うわぁぁっ！間に合え――！"},{"Orange":"","Green":"","Pink":"","Text":"ピンクマン:……時間終了。生存者のみ、次のゲームに進みます。"},{"Orange":"（休憩所・食事シーンなど。人間関係の深堀り）","Green":"","Pink":"","Text":"Scene 3: 中間演出A:"},{"Orange":"","Green":"","Pink":"プレイヤー主役級全員登場。あぐらかいで食事を取ってる雰囲気","Text":"ジヨン:家族、いるの？"},{"Orange":"","Green":"","Pink":"","Text":"セビョク:北に...弟が一人...。迎えにいかなくちゃ"},{"Orange":"","Green":"","Pink":"","Text":"ジヨン:弟、まだ小さいの？"},{"Orange":"","Green":"","Pink":"","Text":"セビョク:うん。まだ、小学生くらい"},{"Orange":"","Green":"","Pink":"","Text":"ジヨン:私にできること、あったら言って。"},{"Orange":"","Green":"","Pink":"","Text":"セビョク:（うんって頷く）"},{"Orange":"","Green":"","Pink":"","Text":":(少し間を空ける)"},{"Orange":"","Green":"","Pink":"","Text":"ギフン:どうして参加したんだ？"},{"Orange":"","Green":"","Pink":"","Text":"アリ:妻と子がいます。でも、韓国では...働いても....足りないんです。"},{"Orange":"","Green":"","Pink":"","Text":"ギフン:(驚いた感じで)子供もいるのか..."},{"Orange":"","Green":"","Pink":"","Text":"アリ:ええ。まだ小さい。笑う顔を見るたび守りたいと思う。"},{"Orange":"","Green":"","Pink":"","Text":"ギフン:昔からお前は頭が良かった。でも、これは違うだろ...."},{"Orange":"","Green":"","Pink":"","Text":"サンウ:勝たなきゃ意味がない。ここには、正解も、倫理もないんだよ"},{"Orange":"","Green":"","Pink":"","Text":"イルナム:こうやって床に座って飯を食うと子供の頃を思い出すねえ"},{"Orange":"","Green":"","Pink":"","Text":"ドクス:くだらねぇ話ばっかだな。ここじゃ家族も友情も関係ねぇ。残るのは、強ぇ奴だけだ。"},{"Orange":"","Green":"","Pink":"","Text":"Scene 4: Game 2 綱引き【3分】:"},{"Orange":"","Green":"","Pink":"","Text":"フロントマン:第二ゲームは「綱引き」です。"},{"Orange":"","Green":"","Pink":"","Text":"イルナム:昔、村祭りで綱引きをしたことがあってねぇ…。力より心を合わせることが大事なんだ。"},{"Orange":"","Green":"","Pink":"","Text":"ドクス:お前ら、全員弱そうだなw 今ここで全員、奈落に落ちろ！！"},{"Orange":"","Green":"","Pink":"","Text":"ギフン:引けぇぇ！！"},{"Orange":"","Green":"","Pink":"","Text":"ギフン(元:イルナム):いいか…一歩前に出るんだ。相手がよろけたとき、一気に引け！！"},{"Orange":"","Green":"","Pink":"","Text":"ギフングループ:せーの！"},{"Orange":"","Green":"","Pink":"","Text":"サンウ:今だ！引けーー！！"},{"Orange":"","Green":"","Pink":"","Text":"モブ3:うわぁぁっ！！"},{"Orange":"","Green":"","Pink":"","Text":"モブ4:助けてくれ……！"},{"Orange":"","Green":"","Pink":"","Text":"ギフン:生き延びた…"},{"Orange":"","Green":"","Pink":"","Text":"イルナム:よくやった…全員無事だ。"},{"Orange":"","Green":"off","Pink":"","Text":"ピンクマン:勝者チーム、残留。"},{"Orange":"","Green":"","Pink":"","Text":"Scene 5: 中間演出 【2分程度】:"},{"Orange":"","Green":"","Pink":"","Text":"ジヨン:……眠れる？"},{"Orange":"","Green":"","Pink":"","Text":"セビョク:あんたこそ。"},{"Orange":"","Green":"","Pink":"","Text":"アリ:……ありがとう。助けてくれて。"},{"Orange":"","Green":"","Pink":"","Text":"ギフン:生き延びなきゃ……意味がないからな。"},{"Orange":"","Green":"(暗転→スポットライトが二人だけを照らす)","Pink":"","Text":"ジヨン:ねぇ……もしこの先、あなたが生き残ったら――弟に会いに行ってほしい。"},{"Orange":"","Green":"","Pink":"","Text":"セビョク:何を言っているのよ……そんなの、一緒に――"},{"Orange":"","Green":"","Pink":"","Text":"ジヨン:私は……ずっと生きる理由を探してきた。でも、あなたには弟がいる。守る人がいる。だから……お願い。"},{"Orange":"","Green":"","Pink":"","Text":"セビョク:そんな勝手なこと言わないで……！私だって……一緒にいたいのに……！"},{"Orange":"","Green":"","Pink":"","Text":"ジヨン:ありがとう。……友達になってくれて。"},{"Orange":"","Green":"","Pink":"","Text":"ピンクマン:脱落。"},{"Orange":"","Green":"","Pink":"","Text":"セビョク:ジヨン！！！"},{"Orange":"","Green":"","Pink":"","Text":"Scene 6: Game 3 ガラス橋(VFX)【3分】:"},{"Orange":"","Green":"","Pink":"","Text":"OBS:sijag"},{"Orange":"","Green":"","Pink":"","Text":"フロントマン:――次が最後のゲームだ。"},{"Orange":"","Green":"","Pink":"","Text":"Scene 7: Game 4 イカゲーム【2分】:"},{"Orange":"","Green":"","Pink":"","Text":"フロントマン:ファイナルゲーム、『イカゲーム』。相手を制圧したほうが勝利です。"},{"Orange":"","Green":"","Pink":"","Text":"サンウ:殺せよ！そうしないと意味ないやろ！"},{"Orange":"","Green":"","Pink":"","Text":"ギフン:……勝っても意味ないだろ！こんなやり方じゃ……"},{"Orange":"","Green":"","Pink":"","Text":"ギフン:ギフン"},{"Orange":"","Green":"","Pink":"","Text":"サンウ:お前なんかに、俺の人生……！"},{"Orange":"","Green":"","Pink":"","Text":"ギフン:俺は……誰も傷つけずには……生きられないのか！"},{"Orange":"","Green":"","Pink":"","Text":"サンウ:(自ら刺して)せめて……お母さんに……お金を……"},{"Orange":"","Green":"","Pink":"","Text":"フロントマン:勝者、ギフン。"},{"Orange":"","Green":"","Pink":"","Text":"VIP:(拍手しながら登場)面白い人間劇でしたね"},{"Orange":"","Green":"","Pink":"","Text":"ギフン:こんなの……遊びじゃない……！"},{"Orange":"","Green":"","Pink":"","Text":"ナレーター:人は、何を失えば『人間』ではなくなるのか。欲望と絶望が交差する先に、勝者はいた。
この答えを知るものは、もう彼だけだ。"},{"Orange":"終了","Green":"","Pink":"","Text":"ナレーター:名前呼ぶ+名前映像"}]


</script>

<script>
const DB_BASE = 'https://couud-dashboard-default-rtdb.firebaseio.com';
const DB_KEY  = 'nunhoa:1';
const POLL_MS = 100;
const DB_URL = `${DB_BASE}/${encodeURIComponent(DB_KEY)}.json`;

let rawPages = [];
try { 
  // JSONデータの制御文字対策
  let jsonText = document.getElementById('pages-data').textContent || '[]';
  // 制御文字（\u000Aなど）を除去
  jsonText = jsonText.replace(/[\u0000-\u001F]+/g, ''); 
  rawPages = JSON.parse(jsonText); 
} catch(e) { 
  rawPages = []; 
  console.error(e); 
}
const pages = Array.isArray(rawPages) ? rawPages : [];

let currentIndex = 0;
let lastRemoteTs = 0;
const elCurrent = document.getElementById('pageCurrent');
const elNext = document.getElementById('pageNext');
const elInterval = document.getElementById('intervalMs'); elInterval.textContent = POLL_MS;

function escapeHtml(s) { return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;'); }

function renderPage(index) {
  index = ((index % pages.length) + pages.length) % pages.length;
  const cur = pages[index];
  const nxt = pages[(index + 1) % pages.length];

  // ページデータが存在しない場合は空表示
  if (!cur) {
    elCurrent.innerHTML = '';
  } else {
    elCurrent.innerHTML = Object.keys(cur)
      .filter(k => k !== 'Text' && cur[k] && cur[k].trim() !== '')
      .map(k => `<div class="block blk-${k}"><div class="text">${escapeHtml(cur[k])}</div></div>`)
      .join('') +
      `<div class="block blk-Text" style="flex-grow:1;"><div class="text">${escapeHtml(cur.Text||'')}</div></div>`;
  }

  if (!nxt) {
    elNext.innerHTML = '';
  } else {
    elNext.innerHTML = `<div class="text">${escapeHtml(nxt.Text||'')}</div>`;
  }
  currentIndex = index;
}

async function writeIndexToFirebase(index){
  try{
    await fetch(DB_URL, {
      method:'PATCH',
      headers:{'Content-Type':'application/json'},
      body:JSON.stringify({index:index, updatedAt:Date.now()})
    });
  }catch(e){console.error(e);}
}

function goNext(){
  const next = (currentIndex + 1) % pages.length;
  renderPage(next);
  writeIndexToFirebase(next);
}
function goPrev(){
  const prev = (currentIndex - 1 + pages.length) % pages.length;
  renderPage(prev);
  writeIndexToFirebase(prev);
}

document.getElementById('nextBtn').addEventListener('click', goNext);
document.getElementById('backBtn').addEventListener('click', goPrev);
window.addEventListener('keydown', e=>{if(e.key==='ArrowRight') goNext(); if(e.key==='ArrowLeft') goPrev();});

// ページジャンプ機能
const pageJumpInput = document.getElementById('pageJumpInput');
const pageJumpBtn = document.getElementById('pageJumpBtn');
if (pageJumpBtn && pageJumpInput) {
  pageJumpBtn.addEventListener('click', () => {
    const val = parseInt(pageJumpInput.value, 10);
    if (!isNaN(val) && val >= 1 && val <= pages.length) {
      renderPage(val - 1);
      writeIndexToFirebase(val - 1);
    }
  });
  // Enterキーでもジャンプ
  pageJumpInput.addEventListener('keydown', e => {
    if (e.key === 'Enter') pageJumpBtn.click();
  });
}

async function fetchRemote(){
  try{
    const res = await fetch(DB_URL + '?t=' + Date.now(), {cache:'no-store', mode:'cors'});
    if(!res.ok) return;
    const data = await res.json();
    if(!data) return;
    const remoteIndex = (typeof data.index === 'number') ? data.index : null;
    const remoteTs = (typeof data.updatedAt === 'number') ? data.updatedAt : 0;
    if(remoteTs > lastRemoteTs && remoteIndex !== null && remoteIndex !== currentIndex){
      lastRemoteTs = remoteTs;
      renderPage(remoteIndex);
    }
  }catch(e){console.error(e);}
}

if(pages.length){ renderPage(0); }
setInterval(fetchRemote, POLL_MS);
</script>

</body>
</html>
