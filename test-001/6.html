<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ã‚«ã‚¹ã‚¿ãƒ SVGã«ã‚ˆã‚‹æ­ªã¿ãƒ‡ãƒ¢</title>
<style>
  body {
    font-family: sans-serif;
    background: #111;
    color: #eee;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 20px;
    padding: 20px;
  }
  .svg-wrapper {
    display: flex;
    gap: 40px;
    align-items: center;
  }
  .svg-box {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 8px;
  }
  svg {
    width: 200px;
    height: 200px;
    border-radius: 8px;
    background: #222;
  }
  .label {
    font-size: 14px;
    color: #ccc;
  }
</style>
</head>
<body>

<h2>SVG ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ ãƒ‡ãƒ¢ï¼šå¤–éƒ¨SVGã‚’æ­ªã¿ãƒãƒƒãƒ—ã«åˆ©ç”¨</h2>

<div class="svg-wrapper">
  <!-- å…ƒã®SVG -->
  <div class="svg-box">
    <svg id="source-svg" viewBox="0 0 193 110">
      <rect width="193" height="110" fill="#7A7A7A"/>
      <g filter="url(#filter0_f_1191_7)">
        <rect x="33" y="26" width="126" height="54" rx="27" fill="#FF0000"/>
      </g>
      <g filter="url(#filter1_f_1191_7)">
        <rect x="51" y="36" width="89" height="34" rx="17" fill="#2200FF"/>
      </g>
      <g filter="url(#filter2_f_1191_7)">
        <rect x="71" y="45" width="50" height="16" rx="8" fill="#00FF5E"/>
      </g>
      <defs>
        <filter id="filter0_f_1191_7" x="21.6" y="14.6" width="148.8" height="76.8" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB">
          <feGaussianBlur stdDeviation="5.7"/>
        </filter>
        <filter id="filter1_f_1191_7" x="39.6" y="24.6" width="111.8" height="56.8" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB">
          <feGaussianBlur stdDeviation="5.7"/>
        </filter>
        <filter id="filter2_f_1191_7" x="59.6" y="33.6" width="72.8" height="38.8" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB">
          <feGaussianBlur stdDeviation="5.7"/>
        </filter>
      </defs>
    </svg>
    <div class="label">æ­ªã¿ãƒãƒƒãƒ—å…ƒSVG</div>
  </div>

  <!-- æ­ªã¾ã›ã‚‹å¯¾è±¡ -->
  <div class="svg-box">
    <svg id="distort-demo">
      <defs>
        <filter id="displacementFilter">
          <!-- feImageã§ä¸Šã®SVGã‚’ä½¿ã† -->
          <feImage id="displaceImage" xlink:href="" result="imgMap" preserveAspectRatio="xMidYMid slice" />
          <feDisplacementMap in="SourceGraphic" in2="imgMap" scale="50" xChannelSelector="R" yChannelSelector="G"/>
        </filter>
      </defs>
      <rect x="0" y="0" width="200" height="200" fill="#4fc3f7" filter="url(#displacementFilter)" />
    </svg>
    <div class="label">feDisplacementMap ã«ã‚ˆã‚‹æ­ªã¿</div>
  </div>
</div>

<script>
(() => {
  try {
    const sourceSvg = document.getElementById('source-svg');
    const displaceImage = document.getElementById('displaceImage');
    const distortSvg = document.getElementById('distort-demo');

    if (!sourceSvg) throw new Error("source-svg ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚");
    if (!displaceImage) throw new Error("feImage(displaceImage) ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚");
    if (!distortSvg) throw new Error("distort-demo ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚");

    // SVGã‚’Data URIã«å¤‰æ›
    const svgData = new XMLSerializer().serializeToString(sourceSvg);
    const svgBase64 = 'data:image/svg+xml;base64,' + btoa(unescape(encodeURIComponent(svgData)));

    displaceImage.setAttribute('xlink:href', svgBase64);
    console.log("âœ… SVGç”»åƒã‚’ feImage ã«é©ç”¨ã—ã¾ã—ãŸã€‚");

    // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆç·©ã‚„ã‹ã«scaleã‚’å¤‰åŒ–ï¼‰
    const filter = distortSvg.querySelector('#displacementFilter feDisplacementMap');
    if (!filter) throw new Error("feDisplacementMap ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚");

    let frame = 0;
    function animate() {
      const scale = 40 + Math.sin(frame * 0.02) * 20;
      filter.setAttribute('scale', scale.toFixed(2));
      frame++;
      requestAnimationFrame(animate);
    }
    animate();
    console.log("ğŸï¸ ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³é–‹å§‹: scaleå€¤ã‚’å‹•çš„å¤‰æ›´ä¸­ã€‚");

  } catch (err) {
    console.error("âŒ ã‚¨ãƒ©ãƒ¼:", err.message);
  }
})();
</script>

</body>  <script src="check.js"></script>
</html>
